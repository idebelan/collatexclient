<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <title>Client</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script> 
    <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script> 
    <link rel="stylesheet" type="text/css" href="styles/style.css">
 </head>

<body>
    <p><span id="useronline">0</span> users online</p>
    <p><span id="useronlinelist">0</span> list of users online</p>
    <p><span id="loginid">0</span> is the current user ID</p>
    <p><span id="userid">0</span> is the newly registered user ID</p>
    <p><span id="userdocs">0</span> user saved documents</p><br/>
    <textarea id="latex">Your latex goes here</textarea><br/>
    <form action="demo_form.asp" method="get">
        <br>
        <button id ="save" type="button" value="Save">Save</button>
        <button id="convert" type="button" value="Convert">Convert</button>
        <br><br>
        <button id="register" type="button" value="Register">Register</button>
        <input id="email" type="text" value="Email"/>
        <input id="password" type="text" value="Password"/>
        <br><br>
        <button id="getdocs" type="button" value="User documents">User documents</button>
        <input id="docs" type="text" value="User ID"/>
        <br><br>
        <button id="login" type="button" value="Login">Login</button>
        <input id="loginemail" type="text" value="Email"/>
        <input id="loginpassword" type="text" value="Password"/>
        <br><br>
        <button id="logout" type="button" value="logout">Logout</button>
        <input id="useridinlist" type="text" value="User ID"/>
    </form>
    <script>
    $(function () {
     //you can ask socket.io's client to notify the server about disconnect by turning on the sync disconnect on unload flag
        var socket = io.connect('http://localhost:3000',
                         {'sync disconnect on unload':false} ); 
         
        
        //get session id         
        var sessionid;
        var room = "abc123";
        
        socket.on('connect', function() {
        sessionid = socket.io.engine.id;
        socket.emit('room', room);
        
        console.log('ddd:'+ sessionid + 'room = '+room);
        });
       
        //receive character from server
        socket.on('server_character',function(content){
            //console.log('From Server:'+ content);
            document.getElementById('latex').innerHTML=content; 
            //$(latex).append(content);
        });
        //On Keydown
        $('#latex').on('keypress',function(){
            var character= $('#latex').val();
            //send character to servers
            socket.emit('client_character',{buffer:character},sessionid);
            console.log('To Server:'+ {buffer:character} +"---"+sessionid);

        });
       
        
        //Saving the textarea content.
        $( "#save" ).click(function() {
            var doc= $('#latex').val();
            //document
            var document = {     
            name: "doc3",
            content: doc,
            owner:'5704c1c4e559001405ae7bd5',
            };
            socket.emit('client_doc' ,document ,sessionid);
         });
         
         //Converting the textarea content.
         $( "#convert" ).click(function() {
             var documentName="doc3.tex";
             socket.emit('client_convert' ,documentName ,sessionid);
         });
         
         //User logout.
         $( "#logout" ).click(function() {
            var logid= $('#useridinlist').val();
             socket.emit('client_logout' ,logid ,sessionid);
         });
         
          //User login.
        $( "#login" ).click(function() {
            var email= $('#loginemail').val();
            var password= $('#loginpassword').val();
            //alert("e: " + email + " p: "+ password);
            //document
            var user = {     
            userEmail: email,
            userPassword: password
            };
            socket.emit('client_login' ,user ,sessionid);
         });
         
         //Register New User.
        $( "#register" ).click(function() {
            var email= $('#email').val();
            var password= $('#password').val();
            //alert("e: " + email + " p: "+ password);
            //document
            var user = {     
            userEmail: email,
            userPassword: password
            };
            socket.emit('client_register' ,user ,sessionid);
         });
         
        //Get user documents.
         $( "#getdocs" ).click(function() {
             //var userpid="5704c1c4e559001405ae7bd5";
             var userpid = $('#docs').val();
             socket.emit('client_getdocs' ,userpid ,sessionid);
         });
         
         //get newly registered user credentials
            socket.on('server_getdocs',function(docs){
                document.getElementById('userdocs').innerHTML=JSON.stringify(docs);
            });
         
         //get list of users online
            socket.on('server_useronlinelist',function(users){
                document.getElementById('useronlinelist').innerHTML=JSON.stringify(users);
            });
         
        //get newly registered user credentials
        socket.on('server_registration',function(userId){
            document.getElementById('userid').innerHTML=userId;
        });
         
        //get newly registered user credentials
        socket.on('server_login',function(userId){
            document.getElementById('loginid').innerHTML=userId;
        });
         
         //get online users
        socket.on('user_online',function(userOnline){
            document.getElementById('useronline').innerHTML=userOnline;
        });
        
        //get pdf url
        socket.on('server_pdf',function(pdfDocument){
           console.log("Url : "+pdfDocument.url);
        });
    });  
    </script>
   
</body>
</html>